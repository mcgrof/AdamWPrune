# SPDX-License-Identifier: MIT
# Head-to-head comparison: AdamWSPAM vs AdamWPrune, 70% pruning only
# Pure optimizer comparison with controlled variables

# Enable multiple optimizer mode for direct comparison
CONFIG_OPTIMIZER_MODE_MULTIPLE=y

# Extended training for better comparison
CONFIG_BATCH_SIZE=512
CONFIG_NUM_EPOCHS=20
CONFIG_LEARNING_RATE="0.001"
CONFIG_NUM_WORKERS=16
CONFIG_DEVICE="cuda"
CONFIG_DATA_DIR="data"
CONFIG_OUTPUT_DIR="results"
CONFIG_JSON_OUTPUT="training_metrics.json"

# Test both models to ensure generalizability
CONFIG_MODEL_MODE_MULTIPLE=y
CONFIG_MODEL_ENABLE_LENET5=y
CONFIG_MODEL_ENABLE_RESNET18=y
CONFIG_TEST_MODELS="lenet5,resnet18"
CONFIG_LENET5_NUM_CLASSES=10
CONFIG_LENET5_DATASET="mnist"
CONFIG_RESNET18_NUM_CLASSES=10
CONFIG_RESNET18_DATASET="cifar10"

# Only the two fighters: AdamWSPAM and AdamWPrune
CONFIG_OPTIMIZER_ENABLE_ADAMWSPAM=y
CONFIG_OPTIMIZER_ENABLE_ADAMWPRUNE=y

# Pruning configuration:
# - AdamWSPAM will use magnitude pruning (external)
# - AdamWPrune will use state pruning (built-in)
# Both at 70% sparsity for fair comparison
CONFIG_PRUNING_MODE_MULTIPLE=y
CONFIG_PRUNING_ENABLE_MAGNITUDE=y  # For AdamWSPAM
CONFIG_PRUNING_ENABLE_STATE=y      # For AdamWPrune
CONFIG_TARGET_SPARSITY="0.7"
CONFIG_PRUNING_WARMUP=200
CONFIG_PRUNING_FREQUENCY=100
CONFIG_PRUNING_RAMP_END_EPOCH=15
CONFIG_PRUNING_LOG_SPARSITY=y

# Magnitude pruning settings - identical for both optimizers
CONFIG_MAGNITUDE_PRUNING_STRUCTURED=n
CONFIG_MAGNITUDE_PRUNING_NORM="l1"

# SPAM optimizer settings - aggressive tuning
CONFIG_SPAM_THETA="60.0"
CONFIG_SPAM_ENABLE_CLIP=y
CONFIG_SPAM_SPIKE_THRESHOLD="1.5"
CONFIG_SPAM_PERIODIC_RESET=y
CONFIG_SPAM_INTERVAL=500
CONFIG_SPAM_WARMUP=y
CONFIG_SPAM_WARMUP_STEPS=200

# Advanced optimizer settings for fair fight
CONFIG_ADV_USE_AMSGRAD=y
CONFIG_ADV_WEIGHT_DECAY="0.01"
CONFIG_ADV_USE_COSINE_ANNEALING=y
CONFIG_ADV_COSINE_ETA_MIN="1e-7"

# Maximum performance features enabled
CONFIG_COMPILE_MODEL=y
CONFIG_MIXED_PRECISION=y
CONFIG_GPU_WARMUP=y
CONFIG_PIN_MEMORY=y
CONFIG_PERSISTENT_WORKERS=y
CONFIG_PREFETCH_FACTOR=4
CONFIG_GRADIENT_CLIP_NORM="1.0"
CONFIG_SAVE_CHECKPOINT=y
CONFIG_CHECKPOINT_INTERVAL=2

# Detailed logging for analysis
CONFIG_VERBOSE=y
CONFIG_LOG_LEVEL="INFO"
CONFIG_DEBUG=n
CONFIG_PROFILE=n

# Save analysis data
CONFIG_PRUNING_SAVE_MASKS=y
CONFIG_PRUNING_VISUALIZE_MASKS=n
