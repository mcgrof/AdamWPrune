# SPDX-License-Identifier: MIT
# ResNet-50 comparison: AdamWSPAM vs AdamWPrune with AdamWSPAM base at 70% sparsity
# Tests whether AdamWPrune can improve on AdamWSPAM when using it as the base optimizer

# Enable multiple optimizer mode for comparison
CONFIG_OPTIMIZER_MODE_MULTIPLE=y

# Model configuration - ResNet-50 only
CONFIG_MODEL="resnet50"
CONFIG_RESNET50_NUM_CLASSES=100
CONFIG_RESNET50_DATASET="cifar100"
CONFIG_RESNET50_PRETRAINED=n
CONFIG_RESNET50_CIFAR_ADAPTATION=y

# Training settings optimized for ResNet-50
CONFIG_BATCH_SIZE=128
CONFIG_NUM_EPOCHS=100
CONFIG_LEARNING_RATE="0.001"
CONFIG_NUM_WORKERS=8
CONFIG_DEVICE="cuda"
CONFIG_DATA_DIR="./data"
CONFIG_OUTPUT_DIR="./results"
CONFIG_JSON_OUTPUT="training_metrics.json"

# Enable only AdamWSPAM and AdamWPrune for direct comparison
CONFIG_OPTIMIZER_ENABLE_ADAMWSPAM=y
CONFIG_OPTIMIZER_ENABLE_ADAMWPRUNE=y
CONFIG_TEST_OPTIMIZERS="adamwspam,adamwprune"

# Pruning configuration - both use their best methods at 70%
CONFIG_PRUNING_MODE_MULTIPLE=y
CONFIG_PRUNING_ENABLE_MOVEMENT=y  # For AdamWSPAM
CONFIG_PRUNING_ENABLE_STATE=y     # For AdamWPrune
CONFIG_TEST_PRUNING_METHODS="movement,state"

# Single sparsity target: 70%
CONFIG_SPARSITY_ENABLE_70=y
CONFIG_TARGET_SPARSITY="0.7"
CONFIG_PRUNING_WARMUP=10
CONFIG_PRUNING_FREQUENCY=100
CONFIG_PRUNING_RAMP_END_EPOCH=80
CONFIG_PRUNING_LOG_SPARSITY=y

# Movement pruning settings (for AdamWSPAM)
CONFIG_MOVEMENT_PRUNING_BETA="0.9"
CONFIG_MOVEMENT_PRUNING_USE_GRADIENT=y

# State-based pruning settings (for AdamWPrune)
CONFIG_STATE_PRUNING_STRATEGY="hybrid"
CONFIG_STATE_PRUNING_MOMENTUM_WEIGHT="0.5"

# AdamWSPAM settings - optimized for ResNet-50
CONFIG_SPAM_THETA="50.0"
CONFIG_SPAM_ENABLE_CLIP=y
CONFIG_SPAM_SPIKE_THRESHOLD="2.0"
CONFIG_SPAM_PERIODIC_RESET=y
CONFIG_SPAM_INTERVAL=1000
CONFIG_SPAM_WARMUP=y
CONFIG_SPAM_WARMUP_STEPS=100
CONFIG_SPAM_BETA1="0.9"
CONFIG_SPAM_BETA2="0.999"
CONFIG_SPAM_EPSILON="1e-8"
CONFIG_SPAM_WEIGHT_DECAY="0.01"

# AdamWPrune settings - configure to use AdamWSPAM as base
CONFIG_ADAMWPRUNE_BASE_OPTIMIZER="adamwspam"
CONFIG_ADAMWPRUNE_BETA1="0.9"
CONFIG_ADAMWPRUNE_BETA2="0.999"
CONFIG_ADAMWPRUNE_EPSILON="1e-8"
CONFIG_ADAMWPRUNE_WEIGHT_DECAY="0.01"
CONFIG_ADAMWPRUNE_ENABLE_PRUNING=y
CONFIG_ADAMWPRUNE_TARGET_SPARSITY="0.7"
CONFIG_ADAMWPRUNE_WARMUP_STEPS=10
CONFIG_ADAMWPRUNE_RAMP_END_EPOCH=80

# GPU optimization features
CONFIG_COMPILE_MODEL=y
CONFIG_MIXED_PRECISION=y
CONFIG_GPU_WARMUP=y
CONFIG_PIN_MEMORY=y
CONFIG_PERSISTENT_WORKERS=y
CONFIG_PREFETCH_FACTOR=2
CONFIG_GRADIENT_CLIP_NORM="1.0"

# Checkpointing
CONFIG_SAVE_CHECKPOINT=y
CONFIG_CHECKPOINT_INTERVAL=10

# Monitoring and output
CONFIG_VERBOSE=y
CONFIG_LOG_LEVEL="INFO"
CONFIG_DEBUG=n
CONFIG_PROFILE=n
CONFIG_GPU_MONITOR=y
CONFIG_GPU_SAMPLE_INTERVAL=10

# Test matrix configuration
CONFIG_TEST_MATRIX_NAME="resnet50_adamwspam_vs_adamwprune_spam_base"
CONFIG_CONTINUE_ON_ERROR=y

# Analysis features
CONFIG_PRUNING_SAVE_MASKS=n
CONFIG_PRUNING_VISUALIZE_MASKS=n

# Unused optimizer configs (required for config system)
CONFIG_SGD_MOMENTUM="0.9"
CONFIG_SGD_WEIGHT_DECAY="0.0"
CONFIG_ADAM_BETA1="0.9"
CONFIG_ADAM_BETA2="0.999"
CONFIG_ADAM_EPSILON="1e-8"
CONFIG_ADAM_WEIGHT_DECAY="0.0"
CONFIG_ADAMW_BETA1="0.9"
CONFIG_ADAMW_BETA2="0.999"
CONFIG_ADAMW_EPSILON="1e-8"
CONFIG_ADAMW_WEIGHT_DECAY="0.0001"
CONFIG_ADV_USE_AMSGRAD=y
CONFIG_ADV_WEIGHT_DECAY="0.01"
CONFIG_ADV_USE_COSINE_ANNEALING=y
CONFIG_ADV_COSINE_ETA_MIN="1e-6"