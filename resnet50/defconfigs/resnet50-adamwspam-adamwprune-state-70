# ResNet-50: AdamWSPAM and AdamWPrune with state pruning at 70%
# Focused test for the two optimizers that failed

# Model configuration
CONFIG_MODEL_MODE_SINGLE=y
CONFIG_MODEL_SELECT_RESNET50=y

# Test only AdamWSPAM and AdamWPrune
CONFIG_OPTIMIZER_MODE_MULTIPLE=y
# CONFIG_OPTIMIZER_ENABLE_SGD is not set
# CONFIG_OPTIMIZER_ENABLE_ADAM is not set
# CONFIG_OPTIMIZER_ENABLE_ADAMW is not set
# CONFIG_OPTIMIZER_ENABLE_ADAMWADV is not set
CONFIG_OPTIMIZER_ENABLE_ADAMWSPAM=y
CONFIG_OPTIMIZER_ENABLE_ADAMWPRUNE=y

# State pruning at 70% sparsity
CONFIG_PRUNING_MODE_SINGLE=y
CONFIG_PRUNING_SELECT_STATE=y
CONFIG_TARGET_SPARSITY="0.7"

# Standard warmup for pruning
CONFIG_PRUNING_WARMUP=100
CONFIG_PRUNING_FREQUENCY=50

# Training configuration for ResNet-50
CONFIG_NUM_EPOCHS=100
CONFIG_BATCH_SIZE=128
CONFIG_LEARNING_RATE="0.001"

# ResNet-50 specific settings
CONFIG_RESNET50_DATASET="cifar100"
CONFIG_RESNET50_BATCH_SIZE=128
CONFIG_RESNET50_EPOCHS=100
CONFIG_RESNET50_SAVE_MODEL=y

# SPAM configuration
CONFIG_SPAM_THETA="50.0"
CONFIG_SPAM_SPIKE_THRESHOLD="2.0"

# AdamWPrune configuration
CONFIG_ADAMWPRUNE_BASE_ADAMW=y
CONFIG_ADAMWPRUNE_ENABLE_PRUNING=y
CONFIG_ADAMWPRUNE_PRUNING_METHOD="state"
CONFIG_ADAMWPRUNE_TARGET_SPARSITY="0.7"
CONFIG_ADAMWPRUNE_WARMUP_STEPS=100
CONFIG_ADAMWPRUNE_BETA1="0.9"
CONFIG_ADAMWPRUNE_BETA2="0.999"
CONFIG_ADAMWPRUNE_WEIGHT_DECAY="0.01"
CONFIG_ADAMWPRUNE_AMSGRAD=y

# GPU monitoring
CONFIG_GPU_MONITOR=y
CONFIG_GPU_MONITOR_INTERVAL=10

# Advanced options
CONFIG_COMPILE_MODEL=y
CONFIG_MIXED_PRECISION=y
CONFIG_GPU_WARMUP=y
CONFIG_PIN_MEMORY=y

# Expected test combinations (2 total):
# 1. resnet50_adamwspam_state_70 - AdamWSPAM with state pruning at 70%
# 2. resnet50_adamwprune_state_70 - AdamWPrune with built-in state pruning at 70%
